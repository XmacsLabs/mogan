# [201_41] OCR功能

## 如何测试
引流信息：
```
很抱歉，目前OCR功能仅为会员用户提供。
详情请见 https://liiistem.cn 注册即送14天会员！
```

打开201_41.tmu，进行以下测试项：
+ 点击图片悬浮菜单的 OCR 按钮，查看是否在图片下方插入了一段引流信息
+ 使用选择性粘贴功能，对应快捷键 **Ctrl+Alt+v**，呼出菜单后选择OCR，点击确定，会插入一段引流信息
+ 使用智能粘贴功能，对应快捷键 **Ctrl+Shift+v**，确保剪贴板最新的内容是一张图片，按下快捷键，会插入一段引流信息
+ 使用 **插入图片** 与 **粘贴图片** 以外的方式，即除了 **Ctrl+Alt+v** 粘贴图片以及 **插入->图片->插入图片** 以外的任何方式向编辑器输入一张图片，这里建议的方法是直接将文件夹中的图片拖入 Mogan，这样会插入一个没有经过处理的，能够稳定弹出警告的图片。插入后将鼠标移入移出图片范围，查看控制台是否正常输出 **std-warning**，而不是 **too many arguments...** 
+ 截图，进入数学模式，粘贴之后会得到`E=m*c^2`

## 2026/01/07 修复数学模式下OCR粘贴

## 2026/01/07 添加OCR相关翻译

## 2026/01/05 重构OCR相关接口
### What
1. `ocr-and-image-paste` -> `image-and-ocr-paste`：因为先粘贴图片，再粘贴OCR的内容
2. `ocr.scm`中仅保留两个`tm-define`的对外暴露的接口
3. OCR分为两种，一种是`by-cursor`，即在当前光标处插入，另外一种是`by-image`，即在图像下方插入

## 2026/01/04 调整粘贴的OCR行为
### What
1. 在数学模式中，直接粘贴图片，会触发OCR，目前社区版直接粘贴`E=m*c^2`
2. 使用智能粘贴时，如果粘贴图片，那么也会触发OCR

## 2025/12/27 调整OCR之后插入内容的位置
### What
1. 如果是将图片粘贴为文字，应该直接粘贴到当前光标位置
2. 如果是识别图片的内容，那么应该插入到图片的正下方

## 2025/12/25 模拟OCR通信流程
### What

+ 商业版编写 demo 文件，跑通 OCR 识别全流程
+ 进行了代码集成的尝试，待后续测试与改进
+ 修改了插入文字的位置，新的插入位置为图片块内部，图片的下方
+ 修复了负责控制图片对齐方式的函数的警告信息输出问题，使用正确的参数个数

## 2025/12/24 模拟OCR识别
### What
编写了一个接口，供选择性粘贴与智能粘贴使用。在智能粘贴处添加逻辑，仅在剪贴板内容为图片时触发 OCR 粘贴。

## 2025/12/23 初步完成OCR前端
### What 
为图片悬浮菜单的 OCR 按钮添加了实际功能。
