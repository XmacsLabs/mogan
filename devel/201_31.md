# [201_31] Backspace和Delete按键优化

## 如何测试
测试文件：TeXmacs/tests/tmu/201_31_backspace.tmu
- 1.光标移动到图片右边，多次 Backspace 按键，观察图片是否能被完全删除
- 2.光标移动到图片左边，多次 Delete 按键，观察图片是否能被完全删除
- 3.执行 ctrl+z 按键，观察图片是否恢复

测试文件：TeXmacs/tests/tmu/201_21_empty.tmu
- 1.光标移动到图片后面，多次 Backspace 按键，观察图片是否能被完全删除
- 2.光标移动到图片后面，多次 Delete 按键，观察图片是否能被完全删除
- 3.执行 ctrl+z 按键，观察图片是否恢复

## 2025/12/9 回退Ctrl和Backspace相关按键优化

## 2025/11/11
### What
在Scheme层面避免出现`(document )`这种情况，如果 arity 是 1，那么采用`tree-assign!`。

## 2025/11/11
### Why
排版引擎存在一些边界条件，没有妥善处理，以避免段错误。

## 2025/11/07
### Why
光标在图片后面，Backspace按键，会保留图片的样式和源代码，不符合用户的体验
> [Why url](https://gitee.com/XmacsLabs/mogan/issues/ID57S3)

### How
在 `TeXmacs/progs/generic/generic-edit.scm` 的 `kbd-remove` 方法中添加图片删除功能：

``` scheme
(tm-define (kbd-remove t forwards?)
  (:require (tree-in? t '(image)))
  (and-with p (tree-up t)
    (tree-remove! p (tree-index t) 1)))
```

- 当光标在图片上时，获取图片的父节点
- 使用 `tree-remove!` 从父节点中删除图片
- 支持撤销操作（Ctrl+Z）
