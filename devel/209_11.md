# 209_11  将代码模式下的换行修改为继承前行的缩进

## 如何测试
1. 启动Mogan
2. 插入不同语言的代码块
3. 输入代码并换行，测试是否能正确的继承前行的缩进

测试文档：TeXmacs/tests/tmu/209_11.tmu

## 2026/1/27 修改默认代码模式下的缩进函数，修复插件中错误的缩进函数
### What
将`prog-edit.scm`里的`program-compute-indentation`函数由默认返回0改成了继承前一行的缩进
``` diff
-(tm-define (program-compute-indentation doc row col)
-  0)
+(tm-define (program-compute-indentation doc row col)
+  (if (<= row 0) 0
+      (let ((prev-row (program-row (- row 1))))
+        (if prev-row (string-get-indent prev-row) 0))))

```
删除以下插件中错误的`program-compute-indentation`函数定义，让它们使用`prog-edit.scm`中的默认实现：
- Java插件 (`java-edit.scm`): 删除只返回`(get-tabstop)`的函数
- Moonbit插件 (`moonbit-edit.scm`): 删除只返回`(get-tabstop)`的函数
- Scala插件 (`scala-edit.scm`): 删除只返回`(get-tabstop)`的函数
- Lua插件 (`lua-edit.scm`): 删除第二个简单的函数定义（第60-62行），保留第一个Lua特定的缩进逻辑



## 2026/1/26 修复 program-compute-indentation
### What
变更如下
``` diff
-(:require in-prog-scheme?)
+(:mode in-prog-scheme?)
```
`:require`接受的是一个布尔值，如果接受了一个函数，那么就是真。所以`scheme-edit.scm`中的program-compute-indentation实际上覆盖了`prog-edit.scm`中的默认逻辑。

另外，为prog-edit.scm中的接口函数新增了文档。

这个不需要在用户层面测试，只能通过添加日志的方式，确定相关函数是否被调用。

