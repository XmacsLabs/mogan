# 选择性粘贴功能实现

## 如何测试
+ 打开 Mogan STEM，选择菜单栏 **编辑->选择性粘贴...**，查看是否弹出选择性粘贴窗口
+ 使用 **Ctrl+Alt+v**，快捷键，查看是否弹出选择性粘贴窗口
+ 切换为数学模式，打开选择性粘贴窗口，查看左侧提示是否改变为 “数学模式”；退出数学模式，再次打开选择性粘贴窗口，查看左侧提示是否改变为 “文本模式”。
+ 打开选择性粘贴窗口，查看下方说明信息是否与右侧选中项相符合；切换选中项，查看下方说明信息是否变化；切换为数学模式，重复本行测试。
+ 选择 Markdown 格式，点击确定，将会以纯文本格式插入 Markdown 源码，并在 Markdown 源码后插入一段引流信息。
+ 复制对应格式，使用选择性粘贴窗口进行粘贴，查看功能是否正常。
+ 新建两个标签页，将其中一个拖出，在两个窗口中分别打开选择性粘贴窗口，查看粘贴功能是否正常，以及tips是否被翻译为中文
+ 确保剪贴板中最新一条为图片，在软件中使用快捷键进入选择性粘贴窗口，查看是否只有 OCR 相关选项，并对每个选项进行测试：
  + 仅 LaTeX 选项会插入提示信息
  + 图片与 LaTeX 选项会插入两行，第一行为图片，第二行为提示信息
  + 仅图片会正常插入图片
+ 复制HTML、LaTeX、纯文本格式，查看选择性粘贴窗口的状态，左上角是否正确显示来源格式

注：社区版不支持markdown与OCR功能，故虽有选项但无法使用。

## 2025/12/27 智能检测剪贴板内容格式 part2
### What
采用更好的方法实现 `clipboard-format`，解决了性能问题。

## 2025/12/27 智能检测剪贴板内容格式

## 2025/12/27 按Enter可以确认，按ESC可以取消

## 2025/12/27

### What
+ 同时打开多个选择性粘贴窗口，会出现变量共用的问题，这是由于使用了全局变量的缘故，现在将相关变量改为局部变量以修复问题。
+ 翻译了 tips。
+ 当剪贴板中为图片时，会进入图片粘贴菜单。

## 2025/12/12

### What
初步实现选择性粘贴功能，包括：
+ 实现基础功能：选择格式进行粘贴
+ 可以使用菜单项与快捷键呼出选择性粘贴窗口
+ 能够检测当前光标所处位置的模式，比如文本模式与数学模式
+ 可以根据当前模式展示不同的格式选择菜单
+ 可以根据当前选项展示不同的提示说明
