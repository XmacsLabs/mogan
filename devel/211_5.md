# 211_5 subprocess_test.cpp 测试用例的跨平台适配
## 2025/10/10
### Why
在 Windows 平台上，Linux 特有的命令 `ls /no_such_dir` 无法执行，导致测试用例检测失败。此外，原代码中使用了 `#ifndef OS_MINGW` 条件编译来跳过 Windows 平台的部分测试，这限制了测试的全面性。

为了确保测试在 Windows 平台上也能正常运行，需要对测试用例进行跨平台适配，为不同操作系统提供对应的命令和测试逻辑。

### How
通过以下修改实现跨平台适配：

1. **移除平台限制**：移除对 `os_mingw()` 的检查，让 Windows 平台也能运行测试

2. **添加平台特定命令**：使用 `os_win()` 函数为 Windows 和非 Windows 平台提供不同的错误命令
   ```cpp
   // 为不同平台提供不同的命令
   if (os_win()) {
     // 使用cmd.exe执行dir命令，确保错误输出能被正确捕获到stderr
     lolly::system::check_stderr ("cmd.exe /c dir C:\\no_such_dir", stderr_result);
   } else {
     lolly::system::check_stderr ("ls /no_such_dir", stderr_result);
   }
   ```

3. **移除条件编译**：在 `call` 测试函数中移除 `#ifndef OS_MINGW` 条件编译，让所有非 WebAssembly 平台都能测试 xmake 命令


这些修改确保了测试在 Windows 平台上能够正常运行，同时保持了对 Linux/Unix 平台的兼容性，使测试更加全面和可靠。