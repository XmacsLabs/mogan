# 61_2  Python插件支持直接渲染matplotlib的绘图结果

## 2025/11/5

### What

内置Python二进制插件不支持直接渲染matplotlib绘图

### Why

.\TeXmacs\plugins\python\bin\python.pex 缺少matplotlib绘图的判断逻辑

修改前：

```python
def flush_output(data):
    
    if data is None:
        flush_verbatim("")
        return
    
    if isinstance(data, PSOutDummy):
        flush_ps(data.content)
    elif isinstance(data, FileOutDummy):
        if data.content is None:
            flush_verbatim("")
        else:
            flush_file(data.content)
    else:
        flush_verbatim(str(data).strip())
```

修改后：

```python
def flush_output(data):

    if data is None:
        flush_verbatim("")
        return

    if isinstance(data, PSOutDummy):
        flush_ps(data.content)
    elif isinstance(data, FileOutDummy):
        if data.content is None:
            flush_verbatim("")
        else:
            flush_file(data.content)
    # 新增部分
    elif isinstance(data, Line2D):
        if MATPLOTLIB_AVALIABLE:
            x, y = data.get_data()
            fig, ax = plt.subplots()
            ax.plot(x, y)
            with tempfile.NamedTemporaryFile(suffix='.png', delete=False) as tmp:
                fig.savefig(tmp.name)
                flush_file(tmp.name)
            plt.close(fig)
    else:
        flush_verbatim(str(data).strip())
```

添加了新的判断逻辑，能够正确处理Line2D类型的绘图。

### 如何测试

运行 帮助->插件->Python 中的matplotlib例子，能够正常显示matplotlib绘图结果

