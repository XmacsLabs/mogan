# 201_50

## 如何测试
打开测试文档`TeXmacs/tests/tmu/201_50.tmu`。
依次执行,观察查询你函数对应函数返回值是否和下方的结构相匹配（这三个函数只能检测到使用kbd-map所绑定的快捷键）
1. 函数`(get-kbd-bindings "按键序列")`,能够返回指定按键在当前系统中的所有重载定义
get-kbd-bindings函数返回一个 Scheme 列表,返回值的整体结构如下：
```
(
  ;; 绑定条目 1 (Binding Entry 1)
  (
    (Condition_Code_1 Condition_Code_2 ...)  ;; 1. 条件列表 (只有当所有条件都满足才会执行下面的命令)
    Command_Code                             ;; 2. 命令代码 
    Help_String                              ;; 3. 帮助文档 
  )

  ;; 绑定条目 2 (Binding Entry 2)
  ( ... )

  ...
)
```
2. 函数`(get-bindings-by-condition '((条件代码)))`,能够返回指定条件列表所对应的快捷键。
get-bindings-by-condition函数返回一个 Scheme 列表,返回值的整体结构如下：
```
(
  ;; 匹配项 1
  (
    "Key_Sequence"      ;; 1. 按键字符串 (如 "C-2")
    Command_Code        ;; 2. 对应的命令代码
  )

  ;; 匹配项 2
  ( ... )
)
```
3. 函数`(get-bindings-by-command '(命令代码))`，能够返回指定命令所绑定的快捷键。
get-bindings-by-command函数返回一个 Scheme 列表,返回值的整体结构如下：
```
(
  ;; 匹配项 1
  (
    "Key_Sequence"                           ;; 1. 按键字符串
    (Condition_Code_1 Condition_Code_2 ...)  ;; 2. 触发该命令所需的条件列表
  )

  ;; 匹配项 2
  ( ... )
)
```



4. 函数 (kbd-conflict-query '((条件代码)) "按键序列")，能够检测指定按键在特定条件下是否已被占用。 kbd-conflict-query 函数的返回值根据检测结果分为两种情况：
```
;; 情况 1：无冲突
#f

;; 情况 2：有冲突（返回已存在的命令代码）
Command_Code  ;; 占用该位置的现有命令源码 
```


5. 函数 (kbd-execute-edit '((条件代码)) '(命令代码) "旧按键序列" "新按键序列")，用于执行具体的增删改操作,根据参数的不同，分别可能有如下四种行为：

```
(
- 新增: old-key="", new-key="C-a" -> 旧的无动作，新增 C-a 绑定。
- 修改: old-key="C-b", new-key="C-a"  -> 将绑定从 C-b 搬到 C-a。
- 删除: old-key="C-b",  new-key="" -> C-b 被解绑，且没有新绑定生成。
- 无效操作：都为空，直接返回。
)
```


## 2026/1/21  新增函数，能够编辑快捷键和查询快捷键冲突。

## 2026/01/08 新增函数，能够获取指定快捷键的绑定详情，指定命令所绑定的快捷键，指定条件列表下所绑定的快捷键。