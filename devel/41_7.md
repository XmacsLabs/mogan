# 41_7
## 如何测试
点击`帮助->插件->Python`，然后再点击`Some Examples`里面的图片可以正常渲染。（这里需要用户预先手动安装Ghostscript）

## 2025/09/10 修复gs命令行参数中的-g选项
### What
```
/usr/bin/gs -dQUIET  -dNOPAUSE  -dBATCH  -dSAFER  -sDEVICE=pngalpha  -dGraphicsAlphaBits=4  -dTextAlphaBits=4  -g462.0x462.0 -sOutputFile=/tmp/.lolly/74735/EC730328_B462_4440_86B2_390FEFE97D60..png  -r72.0x96.0  -c " -75.0 -223.0 translate gsave " -f /tmp/.lolly/74735/D63026C6_626E_4610_8953_B85BCD3BE150.ps  -c " grestore "
```
上述命令行选项中的`-g`的参数应该是`462x462`

所以需要在拼接命令行的时候做一下相关处理。

## 2025/11/4 修复gs的binary插件没有正确处理\r的问题

### What

运行python插件提供的demo时，gs插件报错，无法将ps文件转换为png图像，图片无法渲染。

### Why

eps/ps 图像在文件头部可以获取图像的大小。目前由于没有正确处理 \r 这种情况，会出现一些问题，需要对取得的字符串进行处理。

修改前：

``` scheme
./TeXmacs/plugins/binary/progs/binary/gs.scm
(define (get-image-size-from-bbox line)
  (let* ((box (string-drop line (length "%%BoundingBox: ")))
         (fbox (and (> (length box) 0) (map string->float (string-split box #\space))))) ;;未处理字符串中的\r
    (and (== (length fbox) 4)
         (list (floor (first fbox)) 
               (floor (second fbox)) 
               (ceiling (third fbox)) 
               (ceiling (fourth fbox)))))) 
```

修改后：

```scheme
(define (get-image-size-from-bbox line)
  (let* ((box (string-drop line (length "%%BoundingBox: ")))
         (num-box (string-replace box "\r" "")) ;;去掉字符串中的\r
         (fbox (and (> (length box) 0) (map string->float (string-split num-box #\space))))) ;;使用处理过的num-box
    (and (== (length fbox) 4)
         (list (floor (first fbox))
               (floor (second fbox))
               (ceiling (third fbox))
               (ceiling (fourth fbox))))))
```



