# 11_44: Unicode的根号下沉问题修复

## 2025/11/19
### What
对默认的 `<sqrt>` 使用的字体进行替换，只需要将这个划分到 `in_unicode_range` 中即可，具体看更改

## 如何测试
### How
测试文件在 `mogan/TeXmacs/tests/tmu/11_44.tmu`
直接打开文件即可，然后可以看到前者并没有下沉了

## 2025/11/17
### What
`<sqrt/>` 和 `<sqr|>` 这二者的渲染出现明显差异，前者走的是 text_box 也就是文本模式的根号渲染，后者是结构性公式根号的渲染, 经过 delimiter_box 来渲染

它们解析出来对应的字符串 
- `<sqrt/>` - 对应 str -> `<sqrt>`
- `<sqrt|>` - 对应 str -> `<large-sqrt-0>`

1. <sqrt>（文本模式 √）

解析为普通 rubber character，字符串为 "<sqrt>"。
生成 text_box_rep，直接走 text_box → text_box_rep::display，y=0。
没有经过 delimiter_box 的 y 居中/下沉调整。
由于字体设计，<sqrt> 这个 rubber character 的基线通常偏下（即“偏下”现象），这其实是字体本身的 metrics 决定的。

2. <large-sqrt-0>（结构性根号）

由 <sqrt|> 结构性公式生成，rubber character 机制会根据内容高度自动选择 <large-sqrt-0> 这种变体。
经过 delimiter_box，y 会被调整，使根号竖直居中于公式内容（y = (top + bot - b->y1 - b->y2) >> 1），并有额外的微调逻辑。
这样 <large-sqrt-0> 的显示位置会被“拉正”，通常视觉上更居中、更美观。

并没有从根本解决这个问题，只是在 display 的时候上移了而已。。。