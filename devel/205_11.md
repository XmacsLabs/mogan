# 205_11 

## 2025/09/22 重构统一的 Emoji 显示与打印逻辑
### What
1. 将 Emoji PNG 图片改用`scalable`对象表示，而非转化为具体的`picture`，更具兼容性。
2. 将 Emoji 字符的渲染逻辑改用`draw_scalable`接口处理。
3. 删除每个渲染器实现类中的`picture png_data_to_picture(string png_data, int w, int h);`接口。
4. 绘制Emoji字符的坐标偏移量，由`shrink (pre_gl, std_shrinkf, std_shrinkf, xo, yo);`中导出的 xo, yo 决定，而非人为固定的20%。

    **Before**
    ```c++
    int   h             = gl->height;
    SI    emoji_y_offset= (h * std_shrinkf * 2 * PIXEL) / 10; // Move down by 20% of emoji height
    // Draw the emoji picture at the specified position
    draw_picture (emoji_picture, x, y - emoji_y_offset, 255);
    ```
    **New**
    ```c++
    glyph gl    = shrink (pre_gl, std_shrinkf, std_shrinkf, xo, yo);
    draw_scalable (emoji_picture, x - xo, y - yo, 255);
    ```   
5. 对于PDF导出场景，重新设置字符大小，使导出 PDF 的 Emoji 大小与屏幕显示效果一致。

    **Before**
    ```c++
    int   w= gl->width, h= gl->height;
    ```   
    **New**
    ```c++
    int   w= gl->width, h= gl->height;
    if (is_printer ()) {
        w= pre_gl->width, h= pre_gl->height;
    }
    ```

### Why
1. PDF 导出含 Emoji 字符的文档时，Emoji 大小异常
2. 原来的Emoji渲染链条：draw_emoji -> png_data_to_picture -> draw_picture，高度依赖各个不同渲染器不同的处理逻辑

   可将其统一为新的链条：draw_emoji -> load_scalable_image -> draw_scalable。

## 2025/09/05 MuPDF：支持Emoji渲染
### What
1. 将`draw_emoji()`移至渲染器基类`renderer_rep`中
2. 为MuPDF单独实现一套`png_data_to_picture()`函数

### Why
Emoji渲染
