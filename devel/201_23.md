# [201_23] 修复 interactive 窗口

## 如何测试

### 测试修复后的 lambda 序列化问题

1. 启动 Mogan STEM，新建文档，输入任意内容
2. 不保存直接关闭 Mogan STEM
3. 检查 `~/.local/share/moganlab/system/interactive.scm` 文件内容应正常，不含非法 symbol
4. 重新启动墨干，应能正常启动

### 测试 interactive 窗口功能

1. 在 `Tools` 菜单栏中打开 `Debugging Tool`
2. 在新出现的 `Debug` 菜单栏中点击 `Execute` -> `Execute system command...`，可以看到交互式窗口弹出，可以填入指令执行
2. 在新出现的 `Debug` 菜单栏中点击 `Execute` -> `Execute scheme expression...`，可以看到交互式窗口弹出，可以填入表达式执行

## 2025/09/18 修复 lambda 在 interactive.scm 中序列化问题

### What

修复 lambda 函数在 interactive.scm 配置文件中序列化失败导致 Mogan STEM 无法启动的问题。

### Why

当用户未保存文档直接关闭时，interactive.scm 会保存最近缓冲区状态。
如果其中包含 lambda，procedure-name 函数会生成 symbol 如 `(symbol "#<lambda (answ)>")`，包含空格和特殊字符，
导致重新启动时 decode 时失败（且该标识符不唯一），下次启动失败。

### How

修改 `procedure-name` 函数，检测 lambda 表达式（以 "#<lambda" 开头），
对于匿名 lambda 返回 `#f`，因为它们无法可靠序列化用于持久化配置。
只对命名过程返回对应的 symbol，避免生成非法 symbol 名称。

注：此行为与 TeXmacs 使用的 guile 1.8 的 `procedure-name` 保持一致，
guile 1.8 在处理 lambda 时也会返回 `#f`。


## 2025/09/16 修复 `Debug` -> `Execute` 等 interactive 窗口

### What

修复 `Debug` -> `Execute` 等 interactive 窗口。

### Why

修复 Bug，增强 UX。

### How

该菜单下的两个按钮会唤出 interactive 窗口。

interactive 窗口需要使用 `property` 检查 procedure 的参数，如 `(property table-set-rows :arguments)`，
其中使用 `procedure-name` 索引定义表，该 procedure 实现有问题，一些 procedure 会返回 lambda 签名而非 procedure 的 identifier。

使用 `format` 函数和 `~A` 格式化选项来确定性修复。

