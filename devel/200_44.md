# 200_44

## 如何测试
```bash
# 启动 Mogan 并运行插件，然后：
# 1. 正常关闭窗口
# 2. 按 Ctrl+C
# 3. kill 命令
# 检查是否残留进程
ps aux | grep -i python
```

## 2026/1/16 完善插件进程清理机制

### What
1. **添加统一的信号处理器** (`src/System/Boot/init_texmacs.cpp`)
   - 新增 `clean_exit_on_signal()` 函数
   - 注册信号：SIGSEGV, SIGTRAP, SIGABRT, SIGTERM, SIGINT, SIGQUIT

2. **优化进程终止机制** (`src/Plugins/Qt/QTMPipeLink.cpp`)
   - 直接使用 `kill()` 终止进程，添加重试机制（最多 4 次，每次 50ms）
   - 支持在首次终止前等待 msecs 毫秒

3. **添加调试日志** (`src/Plugins/Qt/qt_pipe_link.cpp`)

### Why
异常退出（崩溃、Ctrl+C、kill 命令）时插件子进程不会被清理，残留孤儿进程占用系统资源

### 覆盖场景
| 退出方式 | 清理机制 |
|---------|---------|
| 段错误 (SIGSEGV) | 信号处理器 |
| 断点陷阱 (SIGTRAP) | 信号处理器 |
| Abort (SIGABRT) | 信号处理器 |
| Kill 命令 (SIGTERM) | 信号处理器 |
| Ctrl+C (SIGINT) | 信号处理器 |
| Ctrl+\ (SIGQUIT) | 信号处理器 |
| 正常退出 | `quit()` 函数 |
