# [201_37] 实现图片悬浮鼠标样式变化与悬浮菜单

## 如何测试

打开 201_37.tmu，进行以下测试项：
+ 将鼠标放在图片中，查看指针是否变为小手图标
+ 将鼠标移出图片，查看指针是否变回正常小箭头
+ 将鼠标放在图片中，查看图片上方居中位置是否出现一个横向悬浮菜单
+ 在将鼠标移入图片范围内时，仔细查看是否出现了菜单位移的现象，期望不出现
+ 测试左对齐、居中、右对齐按钮功能是否正常
+ 弹出菜单后，上下滚动页面，菜单应始终保持在图片上方
+ 查看当前对齐方式所对应的按钮是否正常高亮
+ 按住ctrl/command，滚动滚轮，查看菜单大小是否跟随变化，以及悬浮菜单上边缘是否介于两行之间。
+ 按住ctrl/command，持续缩小，通过 **(get-window-zoom-factor)** 获取页面缩放值， 当缩放值在 **0.35320088300220753** （即大概35.3%）及以下时，菜单应消失。
+ 缓慢的将鼠标移入图片范围内，进行以下测试项：
  + 在 **2025/12/26 图片悬浮菜单渲染修复** 这次修复之前，会有这样的情况：先出现了一个菜单，然后菜单消失，又出现了一个尺寸与先前不同的菜单。注意！！这个过程很短暂，需要将鼠标尽可能的接近像素级移入图片，如果移动足够缓慢，甚至可以看到先出现的菜单一直停留在页面上，直到再次移动鼠标
  + 修复之后，期望鼠标移入图片范围后，菜单仅出现一次，且出现的菜单尺寸是经过调整的，与当前页面缩放相适应


## 2025/12/27 修改图标
### What
更换了图片位置，更改了图标

## 2025/12/26 图片悬浮菜单渲染修复

### What
之前添加了自动调整悬浮菜单尺寸的函数，结果出现了先显示调整前的菜单，然后尺寸会被调整，视觉上就是菜单闪了一下，变大了或者变小了，现在将其修复。

## 2025/12/22 图片悬浮菜单固定高度

### What
+ 让图片悬浮菜单固定高度为单行段落，且能够随缩放变化大小。
+ 缩放很小的时候坐标会有问题，但此时图标已经非常小，显示菜单已经没有意义，因此在缩放因子<=0.16时让菜单取消显示。

## 2025/12/22 对齐方式按钮突出显示

### What
让当前对齐方式的按钮高亮。

## 2025/12/19 页面滚动时菜单能够跟随滚动

### What
之前页面滚动时菜单会固定在屏幕上原来的位置，不符合常理。

## 2025/12/19 修复错误的图像范围检测逻辑并删除无用函数

### What
+ 之前为优化性能修改的全局静态变量实际作用微乎其微，且增加了代码复杂度，因此除必要外的其他变量重新设置为局部变量，简化代码，这一操作似乎能修复之前的范围检测问题。
+ 某些参考数学补全窗口而编写的代码实际上是完全无用的，在这里删掉。

## 2025/12/18 实现左右对齐与居中逻辑

### What
为菜单按钮绑定函数，实现了左右对齐与居中的功能。

## 2025/12/17 初步实现图片悬浮菜单

### What
根据图片坐标定位菜单位置，在图片上方居中显示一个菜单，可以执行左对齐、右对齐、居中和 OCR 识别的操作。

## 2025/12/16 初步实现图片悬浮鼠标事件

### What
获取图片坐标与指针坐标，对二者进行对比，如果鼠标指针在图片范围内，则切换为小手图标。