# [201_37] 实现图片悬浮鼠标样式变化与悬浮菜单

## 如何测试

打开 201_37.tmu，按照其中的说明进行测试。

## 2026/1/5 修复悬浮菜单显示位置，以及悬浮菜单与滚动条的适配，以及多种缩放比下的不同行为
### What
Linux 与 macOS 下通过测试，Windows仍然存在问题。

## 2025/12/31 仅在document环境中允许显示图片悬浮菜单

### What

+ 图片在表格、题注等其他环境中时，显示悬浮菜单是不合理的，现在添加判断拒绝显示。
+ 粘贴图片或插入图片时亦添加判断，仅图片在document环境下才添加对齐选项。

## 2025/12/28 恢复误删除的对齐按钮高亮功能

## 2025/12/28 修复闪烁问题，修复坐标定位问题
### What
+ 仅进行两次渲染，第一次渲染不调用show()，第二次渲染调用show()之后，只要鼠标不移出图片范围，就不会重新渲染。
+ 坐标定位无法完全准确，因此做以下约束：
  + 缩放系数 <= 0.283 时，菜单尺寸固定为 x=169 y=42，IconSize固定为25, 消除缩放系数过小时autoSize计算的尺寸无限趋近于0的问题。
  + 缩放系数 <= 0.1 时，取消菜单显示，此时菜单大小已经为不可用状态，再显示已无意义。

## 2025/12/27 修改图标
### What
更换了图片位置，更改了图标

## 2025/12/26 图片悬浮菜单渲染修复

### What
之前添加了自动调整悬浮菜单尺寸的函数，结果出现了先显示调整前的菜单，然后尺寸会被调整，视觉上就是菜单闪了一下，变大了或者变小了，现在将其修复。

## 2025/12/22 图片悬浮菜单固定高度

### What
+ 让图片悬浮菜单固定高度为单行段落，且能够随缩放变化大小。
+ 缩放很小的时候坐标会有问题，但此时图标已经非常小，显示菜单已经没有意义，因此在缩放因子<=0.16时让菜单取消显示。

## 2025/12/22 对齐方式按钮突出显示

### What
让当前对齐方式的按钮高亮。

## 2025/12/19 页面滚动时菜单能够跟随滚动

### What
之前页面滚动时菜单会固定在屏幕上原来的位置，不符合常理。

## 2025/12/19 修复错误的图像范围检测逻辑并删除无用函数

### What
+ 之前为优化性能修改的全局静态变量实际作用微乎其微，且增加了代码复杂度，因此除必要外的其他变量重新设置为局部变量，简化代码，这一操作似乎能修复之前的范围检测问题。
+ 某些参考数学补全窗口而编写的代码实际上是完全无用的，在这里删掉。

## 2025/12/18 实现左右对齐与居中逻辑

### What
为菜单按钮绑定函数，实现了左右对齐与居中的功能。

## 2025/12/17 初步实现图片悬浮菜单

### What
根据图片坐标定位菜单位置，在图片上方居中显示一个菜单，可以执行左对齐、右对齐、居中和 OCR 识别的操作。

## 2025/12/16 初步实现图片悬浮鼠标事件

### What
获取图片坐标与指针坐标，对二者进行对比，如果鼠标指针在图片范围内，则切换为小手图标。