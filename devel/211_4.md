# 211_4 哈希测试文件的跨平台适配
## 2025/10/10

### Why
不同操作系统在处理文本文件时使用不同的行尾符（Windows使用CRLF，Linux使用LF），这会导致同一文件在不同平台上计算出不同的哈希值。因此需要为不同平台提供对应的哈希值预期结果，确保测试能够正确通过。

Windows系统和Unix/Linux/macOS系统在文本文件的行尾表示上存在差异：
- Windows使用回车+换行（CRLF，`\r\n`）
- Unix/Linux/macOS使用换行（LF，`\n`）

这种差异会导致相同内容的文件在不同平台上产生不同的哈希值，从而导致跨平台测试失败。

### How
通过os_win()函数为不同平台提供正确的预期哈希值：

#### md5_test.cpp
```cpp
// 添加必要的头文件和命名空间
#include "System/Misc/sys_utils.hpp"
using lolly::system::os_win;

// 使用os_win()函数判断平台
string expected_md5;
if (os_win()) {
  expected_md5 = "3c34afdc3adf82d2448f12715a255122"; // Windows (CRLF) 版本的实际MD5值
} else {
  expected_md5 = "d32239bcb673463ab874e80d47fae504"; // Linux (LF) 版本
}
string_eq (md5_hexdigest (license_file), expected_md5);
```

#### sha_test.cpp
```cpp
// 添加必要的头文件和命名空间
#include "lolly/system/misc/sys_utils.hpp"
using lolly::system::os_win;

// SHA224测试
if (os_win()) {
  expected_sha224 = "d62ef1c7dea18146aba76ae54edc492502102a4a1c525d38ecf36129"; // Windows (CRLF) 版本
} else {
  expected_sha224 = "2f051189f6ddb2d2fd11faeb8cf3e3b38b4216f2798ce1d92421e129"; // Linux (LF) 版本
}

// SHA256测试
if (os_win()) {
  expected_sha256 = "0b383d5a63da644f628d99c33976ea6487ed89aaa59f0b3257992deac1171e6b"; // Windows (CRLF) 版本
} else {
  expected_sha256 = "8ceb4b9ee5adedde47b31e975c1d90c73ad27b6b165a1dcd80c7c545eb65b903"; // Linux (LF) 版本
}
```

修改后，哈希测试在Windows和Linux平台上都能正确通过，确保了跨平台兼容性。