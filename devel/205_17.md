# 205_17 MuPDF：修复绘图中文本放大缩小过程中的闪烁
## 如何测试
启用MuPDF后编译、运行，打开`TeXmacs/tests/tmu/205_17.tmu`这个文档，点击进入绘图模式，尝试放大、缩小其中的箭头，观察是否存在闪烁。

## 2025/12/10
### What
在调试中发现导致闪烁的原因是，在某些条件下，MuPDF文本渲染函数会报错“cannot draw text since font and size not set”
进一步调查发现，在绘图状态重置后，未使用 Tf() 指令设置字体信息，所以MuPDF在放大缩小的某些帧中无法绘制文字，造成闪烁

解决方法：
在`mupdf_renderer_rep::begin_text()`中，当发现绘图状态重置后（`in_text == false`），应当重置当前字体变量：`cfn`，这样能够确保在后续的`mupdf_renderer_rep::draw()`中一定会调用Tf()指令设置字体。

### Why
在启用MuPDF渲染器后，对绘图中的文本对象进行放大缩小操作时会导致闪烁