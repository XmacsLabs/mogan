# [202_104] 非空文档不支持切换为beamer

### 如何测试
1. 新建一个空文档，切换样式为beamer，确认可以成功切换
2. 在文档中输入任意文字内容，或打开一个已有的非空文档，切换样式为beamer，确认无法切换，并弹窗“Cannot switch style”提示“The document is not empty”。
3. 清空文档内容后，切换样式为beamer，确认可以成功切换

## 2026/01/14
### What
禁止将非空文档切换为beamer样式

### Why
非空文档可能含有与beamer样式不兼容的内容，强制切换可能导致严重crash

### How
用 `tree-empty?` 检查当前文档是否为空
```scheme
(tm-define (document-empty?)
  (:synopsis "Check if current document is empty")
  (with t (buffer-tree)
    (tree-empty? t)))
```

切换样式时调用 ``document-empty?`` 进行检查
```scheme
(tm-define (set-main-style style)
  ;; ...
  (if (and (== style "beamer") (not (document-empty?)))
      (show-message "The document is not empty" "Cannot switch style")
      (begin
          (let* ((old (get-style-list))
                 (new (if (null? old) (list style) (cons style (cdr old)))))
            (set-style-list new))
          (delayed
            (:idle 1)
            (notify-new-style style)))))
```