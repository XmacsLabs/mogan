# [211_6] 修复多用户情况下lolly临时文件混乱问题

## 如何测试

### 准备工作
- 1.移除墨干的xmake.lua脚本进入lolly的工作目录
``` bash
rm ./xmake.lua
cd 3rdparty/lolly
# 清理项目构建的缓存
rm .xmake/
rm build/
```
- 2.不同操作系统编译
```  bash
# 1.1 windows:如果没有移除项目中的xmake.lua此命令无法执行, 添加运行时以适配windows,linux不需要执行
xmake config -vD --yes --enable_tests=true  --vs_runtime=MT
# 1.2 linux
xmake config -vD --yes --enable_tests=true
# 2.进行构建
xmake build -vD liblolly
```
- 3.测试及运行

```  bash
xmake test #会产生临时目录！！
xmake b -vD # Windows上不需要，直接run也会触发
xmake run -vD
```

### 验证临时文件目录 (lolly)
- **Windows**: `%TMP%/<username>/.lolly/<pid>`
- **macOS**: `/tmp/<username>/.lolly/<pid>`
- **Linux**: `/tmp/<username>/.lolly/<pid>`

## 2025/11/06 修复无法编译的问题 
### what
在多用户环境下，当多个用户同时使用Mogan时，lolly的临时文件会混在一起，导致文件冲突和权限问题。

### why
原有的临时文件路径结构为：`$TMP/.lolly/<pid>` 或 `/tmp/.lolly/<pid>`，缺少用户隔离层，导致不同用户的临时文件存储在相同目录下。

### how
在临时文件路径中加入用户名作为隔离层，新的路径结构为：`$TMP/<username>/.lolly/<pid>` 或 `/tmp/<username>/.lolly/<pid>`