# 209_9 修复代码模式的中文换行显示问题

## 如何测试 
1. 启动 Mogan / TeXmacs
2. 插入以下任意代码环境之一（或其他支持的代码环境）：
   - `\code`
   - `\python-code`
   - `\cpp-code`
   - `\r-code`
   
3. 输入一行**足够长**、包含**中文字符**的内容，例如：
```tex
z中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中
```
4. 在开头输入字符以触发不同位置的自动换行

期望结果：

- 中文字符不会被拆分

- 不再出现 <#XXXX> 或在 < 处断裂的异常显示

- 中文字符要么完整出现在上一行，要么完整出现在下一行

测试文档:  TeXmacs/tests/tmu/209_9.tmu

## 2026/1/21
### What 
修复在代码模式下（包括 \code、\python-code、\cpp-code 等环境）
中文字符在自动换行时被错误拆分、显示为 <#XXXX> 的问题。

### Why 
代码模式在自动换行时直接按字符串下标切分字符串，
当断行位置落在 <#XXXX> 内部时，会破坏内部转义结构，
最终导致渲染失败并显示为 <#XXXX>。

关联issue #2605

### How 
在 verb_language_rep::hyphenate 与 prog_language_rep::hyphenate 中
引入断行边界保护机制：

- 将 <#...> 内部转义序列视为不可拆分的原子

- 若断行位置落在原子内部，则向左吸附到最近的合法边界

- 仅在合法边界处对字符串进行切分
