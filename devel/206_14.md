# 206_13
## 2025/09/08 修复 206_9 造成的插入中文省略号卡死的问题
### 如何测试
#### 测试中文省略号的插入
1. 切换输入法为中文
2. 按下 Shift-6 插入中文省略号 （可能需要 Enter 输入）。此时显示的内容为 <...>
4. 观察：中文省略号正常插入 `......`

#### 测试 206_13 中解决的问题是否被解决
1. 插入表情 "☺️"
2. 检查表情被插入，编辑器没有 Crash。注意（插入的表情后面还有一个crok，这与先前版本的表现是一致的，不是此PR引入的问题）

### What
修复了了使用键盘插入中文省略号造成卡死的问题。

### Why？
在 206_9 中，在判断一个 key 是否需要 unwrap 的时候添加了 `tm_string_length (key) == 1` 的条件（see:https://gitee.com/XmacsLabs/mogan/commit/f75250874b4f139da0de23f7635d276759ebd80c）

这导致部分正常字符在输入的时候被错误地判断，例如，中文省略号的 key 为 `<ldots><ldots>`，它在处理的中间过程中本应该先被 unwrap 为`ldots><ldots`，但是在新的条件下，由于其长度为2，不会收到unwrapp，这就导致后续处理的结果变成了错误的`<<ldots><ldots>>`，插入到编辑器中显示为 `<...>`，造成一系列问题。

### How?
删除 `tm_string_length (key) == 1` 的条件，添加对每一个字符进行判断的逻辑，判断条件与 206_9 修改前相同，一旦有不符合条件的，就不进行 unwrap。

这样既保证了解决 206_9 解决的问题，也保证原有逻辑不受影响
