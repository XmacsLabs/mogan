# 202_62 Tab cycling Popup 显示的图标和实际不符 && 数学提示浮动窗口的上下位置调整

## 如何测试
### 数学提示自动弹出
1.进入数学模式：$
2.任意输入一个序列，比如输入 `< tab tab =`时，
原效果：需要再按一下 tab 才能弹出以`⊆`为基本序列的可切换列表
优化后效果：按下`< tab tab =`弹出以`⊆`为基本序列的可切换列表；此时再按 `tab` 会在列表中轮转

### Tab cycling Popup 显示的图标和实际不符
1.进入数学模式：$
2.输入 `< tab tab = tab`时，
原效果：原代码删除所有 ` tab`，导致只基于 `< =` 查找符号，而不是基于完整的 `< tab tab =` 序列显示可切换列表。
优化后效果：基于完整的 `< tab tab =` 序列查找符号。

### 数学提示浮动窗口的上下位置调整
进入数学模式：$，输入<，按tab键，观察提示浮动窗口的位置，挡住最下面的内容。


## 2025/11/24 数学提示自动弹出
### Why
此前提示只会`< tab tab =` 后在按下 Tab 后才切换正确列表，容易造成误导。

### How
1. `TeXmacs/progs/math/math-edit.scm` 新增 `math-tabcycle-menu-needed?`，判断 comb 是否存在 tab 且math-tabcycle-symbols` 是否返回多于一个候选，用于区分需要展示弹窗的情况。
2. `src/Edit/Interface/edit_keyboard.cpp::math_complete_try` 调用该辅助函数，若 comb 存在 tab 且候选列表 > 1即直接创建弹窗，否则隐藏弹窗。


## 2025/11/24
### Why
修复Tab序列解析错误：输入 `< tab tab = tab` 时，原代码删除所有 ` tab`，导致只基于 `< =` 查找符号，而不是基于完整的 `< tab tab =` 序列。

### How
`TeXmacs/progs/math/math-edit.scm` 的 `tabcycle-symbols` 函数中，将 `string-replace` 删除所有 ` tab` 改为递归删除末尾的 ` tab`：


## 2025/11/04
### Why
Tab cycling Popup 显示的数学提示浮动窗口会小小挡住最下面的内容，影响用户体验

### How
`src/Plugins/Qt/QTMMathCompletionPopup.cpp`里添加 `y+= 10;`，在 `getCachedPosition` 方法中，计算 y 坐标后添加 `y += 10;` 将提示窗口向下偏移 10 像素，避免遮挡下方内容。
