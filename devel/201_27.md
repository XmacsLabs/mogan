# [201_27] 修复分页时表格行间空隙

### 如何测试

插入一张表格，启动分页，检查表格行间是否存在缝隙，应没有缝隙

## 2025/10/10

### What
在某些视图中分页的表格边框会被渲染加粗

### Why
在`line_end`中插入`line_sep`使得边框仍然存在间隔（只是强行置零行间距而不可见）

在抗锯齿叠加后视觉上边框会变粗

### How
使用一个全局标记`tbl_par`，并在`lazy_paragraph_rep::format_paragraph_unit (int the_start, int the_end)`中特判`line_end`添加方式：
```cpp
line_end (tbl_par ? space (0) : line_sep, 1);
```


## 2025/10/9

### What
在启动分页的表格中，行间显示存在缝隙，希望消除

### Why
启用表格分页（hyphen）后，表格会被转换为“段落的多行”（即一行一个box数组），行间缝隙来源于

竖向分隔（height、sep、ver_sep、bot、top变量）在无碰撞时仍保留的间距

### How
在`convert (edit_env env, array<box> bs, path ip)`中，对行数大于1的表格段落中插入`tbl_par`标志：
```cpp
if (n > 1) {
  box b2= empty_box (decorate (ip), 0, 0, 0, env->fn->yx);
  a << line_item (CONTROL_ITEM, OP_SKIP, b2, 0, tuple ("tbl_par"));
}
```

并在`lazy_paragraph_rep::format_paragraph ()`特判处理：
```cpp
if (is_tbl_par) sss->set_env_vars (0, 0, hor_sep, 0, 0, 0, array<SI> ());
else sss->set_env_vars (height, sep, hor_sep, ver_sep, bot, top, swell);
```