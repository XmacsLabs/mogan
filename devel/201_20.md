# [201_20] 修复大范围复制的数组越界崩溃

## 2025/09/10 修复大范围复制的数组越界崩溃

### Why

当文档变大，<Ctrl-a> 全选时复制很容易触发，卡死或崩溃。

本次变更修复的崩溃和卡死的问题，是由一个更本质的问题导致的：在这个修复之前，复制任何文本都会在正常文本后面跟一堆乱码，这是因为传递的长度太长，访问越界了，但还是访问到了一些非预期的，非文本的数据。
崩溃和卡死是因为太长了，越界到内存外了。

### How

不指定长度，防止越界。
`selection` 是 C-style 字符串的包装，有 `\0` 结尾；因此 `QString::FromEnc` 的第二个参数 size 设置为 `-1`：独到 `\0` 为止。

原实现的错误来自 `selection` 在解码之前可能被重新赋值，但 size 仍然使用旧的长度，导致越界。

