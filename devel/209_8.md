# [209_8] 新增 SQL 语言语法高亮支持

## 如何测试

一、在文本模式下，点击菜单栏，依次选择：

- 插入 -> 程序 -> 行内代码 -> SQL
- 插入 -> 程序 -> 代码块 -> SQL

输入 SQL 程序，检查是否正确地显示高亮。


二、点击“帮助 -> 插件 —> SQL”，阅读帮助文档。

帮助文档路径如下：

- `TeXmacs/plugins/sql/doc/sql.en.tmu`

若帮助文档内示例代码高亮正常显示，则说明测试通过。

三、测试文档：

- `TeXmacs/tests/tmu/209_8.tmu`


## 插件位置

插件位于 `TeXmacs/plugins/sql` 目录下。插件新增的文件列表如下所示：

- 插件文档：`TeXmacs/plugins/sql/doc/sql.en.tmu`
- 语言样式包：`TeXmacs/plugins/sql/packages/code/sql.ts`
- 编辑功能支持：`TeXmacs/plugins/sql/progs/code/sql-edit.scm`
- 语法支持：`TeXmacs/plugins/sql/progs/code/sql-lang.scm`
- 语言模式：`TeXmacs/plugins/sql/progs/code/sql-mode.scm`
- 格式定义：`TeXmacs/plugins/sql/progs/data/sql.scm`


**插入 -> 程序** 目录，进行了内容修改，对应修改的文件如下所示：

```
TeXmacs/progs/prog/prog-menu.scm
```


## 2026/01/21 优化了 SQL 单行代码去除头尾空白字符的函数，优化了缩进回退的逻辑

### What

修改了 TeXmacs/plugins/sql/progs/code/sql-edit.scm 下的 `string-strip-right` 函数和 `string-strip-right` 函数。

在 `program-compute-indentation` 函数的缩进回退逻辑中，加入了对于前缀空白字符的去除操作。


### Why

在编辑 SQL 代码时，若输入 `END` 或者 `)` 等代表结束的关键词时，编辑器需要将缩进回退一格。

参考程序增加缩进的逻辑，对于上一行的末尾空白字符，需要先去除末尾空白字符，才能判断是否存在 `BEGIN` 或者 `(`。因此，在 `program-compute-indentation` 函数中，增加了对于当前行文本的前缀空白字符的去除操作。

另外，此前的 `string-strip-right` 函数，在实现方法上进行了与 R 语言插件（`TeXmacs/plugins/r/progs/code/r-edit.scm`）的统一。新增了 `string-strip-left` 和 `string-strip` 函数。



## 2026/01/20 新增了小写关键字

## 2026/01/20 修改了 PR 说明文档

## 2026/01/20 新增了 SQL 语言插件，提供 SQL 语法高亮功能支持

