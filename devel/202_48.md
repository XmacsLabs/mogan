# [202_48] 演讲模式下按ESC退出全屏

## 如何测试
在幻灯片放映（演讲模式）下，按下ESC键，检查是否成功退出全屏模式

## 2025/09/21

### What
在编辑器中添加对ESC键的支持，以便在演讲模式下按下ESC键可以退出全屏模式

### Why
在演讲模式下，我们通常需要按下ESC键来退出全屏模式

然而，当前版本的TeXmacs并未实现这一功能

为了解决这个问题，我们决定在编辑器中添加对ESC键的支持，以便用户能够方便地退出全屏模式

### How
仅修改tm-view.scm:

由于ESC已被wildcard预重写为前缀键，见prefix-kbd.scm中:

```scheme
(kbd-wildcards
  ("escape" "M-" #t)
  ("escape escape" "A-" #t)
  ("escape escape escape" "C-" #t)
  ("escape escape escape escape" "noop" #t)
  ("S-escape" "M-A-" #t)
  ("S-escape S-escape" "M-C-" #t)
  ("S-escape S-escape S-escape" "A-C-" #t)
  ("S-escape S-escape S-escape S-escape" "noop" #t))
```

故需要在全屏模式下做一个条件覆盖:
```scheme
(delayed
  (:idle 0)
  (lazy-keyboard-force #t)
  (kbd-map
    (:require (or (full-screen?) (full-screen-edit?)))
    ("escape" (exit-fullscreen) "Exit full screen")
    ("M-"     (exit-fullscreen) "Exit full screen")
    ("A-"     (exit-fullscreen) "Exit full screen")))
```

另定义exit-fullscreen以处理不同的fullscreen:
```scheme
(define (exit-fullscreen)
  (if (full-screen-edit?)
      (toggle-full-screen-edit-mode)
      (toggle-full-screen-mode)))
```